<?xml version="1.0" encoding="UTF-8"?>
<project default="all">
	<propertyfile file="build.number" />
	<property name="bin-dir" location="bin" />
	<property name="dist-dir" location="dist" />
	<property name="jar-dir" location="jar" />
	<property name="lib-dir" location="lib" />
	<property name="slicer-jar" location="${jar-dir}/slicer.jar" />
	<property name="src-dir" location="src" />
	<property name="test-bin-dir" location="testbin" />
	<property name="test-src-dir" location="test" />
	<property name="test-report-dir" location="reports" />
	<property name="junit-lib" location="${lib-dir}/junit-dep-4.9b2.jar" />
	<property name="hamcrest-core-lib" location="${lib-dir}/hamcrest-core-1.3.0RC1.jar" />
	<property name="hamcrest-library-lib" location="${lib-dir}/hamcrest-library-1.3.0RC1.jar" />
	<property name="opencsv-lib" location="${lib-dir}/opencsv-2.3.jar" />

	<path id="compile-slicer-classpath">
		<pathelement location="${opencsv-lib}" />
	</path>
	
	<path id="compile-test-classpath">
		<pathelement location="${slicer-jar}" />
		<fileset dir="${lib-dir}" includes="*.jar"/>
	</path>

	<path id="run-test-classpath">
		<fileset dir="${lib-dir}" includes="*.jar"/>
		<pathelement location="${slicer-jar}" />
		<pathelement location="${test-bin-dir}" />
	</path>

	<target name="all" depends="test" />

	<target name="clean">
		<delete dir="${bin-dir}" quiet="true" />
		<delete dir="${jar-dir}" quiet="true" />
		<delete dir="${test-bin-dir}" quiet="true" />
		<delete dir="${test-report-dir}" quiet="true" />
	</target>
	
	<target name="compile-slicer">
		<mkdir dir="${bin-dir}" />
		<javac srcdir="${src-dir}" destdir="${bin-dir}" includeAntRuntime="false">
			<classpath refid="compile-slicer-classpath" />
		</javac>
	</target>

	<target name="compile-tests">
		<mkdir dir="${test-bin-dir}" />
		<javac srcdir="${test-src-dir}" destdir="${test-bin-dir}" includeAntRuntime="false">
			<classpath refid="compile-test-classpath" />
		</javac>
	</target>
	
	<target name="dist" depends="test">
		<buildnumber/>
		<property name="version" value="0.1.${build.number}" />
		<copy file="${slicer-jar}" toFile="${dist-dir}/slicer-${version}.jar" />
	</target>

	<target name="init">
		<tstamp />
	</target>

	<target name="jar" depends="compile-slicer">
		<unjar src="${opencsv-lib}" dest="${bin-dir}" />
	    <jar destfile="${slicer-jar}"
	         basedir="${bin-dir}"
	         includes="**/*.class"
	         />
	</target>

	<target name="test" depends="jar,compile-tests">
		<junit>
			<classpath refid="run-test-classpath" />
			<batchtest fork="yes" todir="${test-report-dir}">
				<fileset dir="${test-bin-dir}">
					<include name="com/dhemery/slicer/test/acceptance/**/*"/>
				</fileset>
				<formatter type="brief" usefile="no" />
			</batchtest>
		</junit>
	</target>
</project>
